<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/player_rank_controller - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/player_rank_controller.html#var">Var Details</a> - <a href="datum/player_rank_controller.html#proc">Proc Details</a></header><main><h1>player_rank_controller <aside>/<a href="datum.html">datum</a>/<a href="datum/player_rank_controller.html">player_rank_controller</a></aside> <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L10"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 10"></a></h1><p>This datum is intended to be used as a method of abstraction for the different
ways that each player rank handles adding and removing players from their global
lists, as well as handling the legacy adding, removing, loading and saving of
said lists.</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/player_rank_controller.html#var/legacy_file_header">legacy_file_header</a></th><td>The header for the legacy file, if any.
Leave as <code>&quot;&quot;</code> if you don't have one.</td></tr><tr><th><a href="datum/player_rank_controller.html#var/legacy_file_path">legacy_file_path</a></th><td>The path to the legacy file holding all of the players that have this rank.
Should be set in <code>New()</code>, since it has a non-constant compile-time value.</td></tr><tr><th><a href="datum/player_rank_controller.html#var/rank_title">rank_title</a></th><td>The name of the player rank in the database.
This <strong>NEEDS</strong> to be set by subtypes, otherwise you WILL run into severe
issues.</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/player_rank_controller.html#proc/add_player">add_player</a></th><td>Handles adding this rank to a player by their ckey. This is only intended to
be used for handling the in-game portion of adding this rank, and not to
save this change anywhere. That should be handled by the caller.</td></tr><tr><th><a href="datum/player_rank_controller.html#proc/add_player_legacy">add_player_legacy</a></th><td>Handles adding this rank to a player using the legacy system, updating the
legacy config file in the process.</td></tr><tr><th><a href="datum/player_rank_controller.html#proc/clear_existing_rank_data">clear_existing_rank_data</a></th><td>Simple proc for subtypes to override for their own handling of clearing any
lists that need to be cleared before loading the player rank data.</td></tr><tr><th><a href="datum/player_rank_controller.html#proc/get_ckeys_for_legacy_save">get_ckeys_for_legacy_save</a></th><td>Simple proc for subtypes to override for their own handling of obtaining
a list of ckeys to save during a legacy save.</td></tr><tr><th><a href="datum/player_rank_controller.html#proc/get_ckeys_to_migrate">get_ckeys_to_migrate</a></th><td>Handles returning a list of all the legacy ckeys that should be migrated
from the legacy system to the database one.</td></tr><tr><th><a href="datum/player_rank_controller.html#proc/load_from_query">load_from_query</a></th><td>Handles loading the players that have this rank from an already-executed
database query.</td></tr><tr><th><a href="datum/player_rank_controller.html#proc/load_legacy">load_legacy</a></th><td>Handles loading the players that have this rank from its legacy config file.</td></tr><tr><th><a href="datum/player_rank_controller.html#proc/remove_player">remove_player</a></th><td>Handles removing this rank from a player by their ckey. This is only
intended to be used for handling the in-game portion of removing this rank,
and not to save this change anywhere. That should be handled by the caller.</td></tr><tr><th><a href="datum/player_rank_controller.html#proc/remove_player_legacy">remove_player_legacy</a></th><td>Handles removing this rank from a player using the legacy system, updating
the legacy config file in the process.</td></tr><tr><th><a href="datum/player_rank_controller.html#proc/save_legacy">save_legacy</a></th><td>Handles saving the players that have this rank using its legacy config file.</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/legacy_file_header"><aside class="declaration">var </aside>legacy_file_header <aside>– </aside> <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L20"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 20"></a></h3><p>The header for the legacy file, if any.
Leave as <code>&quot;&quot;</code> if you don't have one.</p><h3 id="var/legacy_file_path"><aside class="declaration">var </aside>legacy_file_path <aside>– </aside> <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L17"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 17"></a></h3><p>The path to the legacy file holding all of the players that have this rank.
Should be set in <code>New()</code>, since it has a non-constant compile-time value.</p><h3 id="var/rank_title"><aside class="declaration">var </aside>rank_title <aside>– </aside> <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L14"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 14"></a></h3><p>The name of the player rank in the database.
This <strong>NEEDS</strong> to be set by subtypes, otherwise you WILL run into severe
issues.</p><h2 id="proc">Proc Details</h2><h3 id="proc/add_player"><aside class="declaration">proc </aside>add_player<aside>(ckey)  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L36"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 36"></a></aside></h3><p>Handles adding this rank to a player by their ckey. This is only intended to
be used for handling the in-game portion of adding this rank, and not to
save this change anywhere. That should be handled by the caller.</p>
<p>DO NOT FORGET TO ADD A <code>IsAdminAdvancedProcCall()</code> CHECK SO THAT ADMINS
CAN'T JUST USE THAT TO SKIP PERMISSION CHECKS!!!</p><h3 id="proc/add_player_legacy"><aside class="declaration">proc </aside>add_player_legacy<aside>(ckey)  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L52"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 52"></a></aside></h3><p>Handles adding this rank to a player using the legacy system, updating the
legacy config file in the process.</p>
<p>Don't override this, everything should be handled from <code>add_player()</code>,
this is mostly just a helper for convenience.</p>
<p>Arguments:</p>
<ul>
<li>ckey - The ckey of the player you want to now possess this player rank.</li>
</ul><h3 id="proc/clear_existing_rank_data"><aside class="declaration">proc </aside>clear_existing_rank_data<aside>()  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L220"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 220"></a></aside></h3><p>Simple proc for subtypes to override for their own handling of clearing any
lists that need to be cleared before loading the player rank data.</p>
<p>DO NOT FORGET TO ADD A <code>IsAdminAdvancedProcCall()</code> CHECK SO THAT ADMINS
CAN'T JUST ELEVATE PERMISSIONS TO CLEAR RANK DATA AND SCREW YOU OVER!!!</p><h3 id="proc/get_ckeys_for_legacy_save"><aside class="declaration">proc </aside>get_ckeys_for_legacy_save<aside>()  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L199"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 199"></a></aside></h3><p>Simple proc for subtypes to override for their own handling of obtaining
a list of ckeys to save during a legacy save.</p>
<p>DO NOT FORGET TO ADD A <code>IsAdminAdvancedProcCall()</code> CHECK SO THAT ADMINS
CAN'T JUST ELEVATE PERMISSIONS TO ADD THEMSELVES TO A LEGACY SAVE!!!</p><h3 id="proc/get_ckeys_to_migrate"><aside class="declaration">proc </aside>get_ckeys_to_migrate<aside>()  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L169"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 169"></a></aside></h3><p>Handles returning a list of all the legacy ckeys that should be migrated
from the legacy system to the database one.</p>
<p>Returns a list of ckeys as strings.</p><h3 id="proc/load_from_query"><aside class="declaration">proc </aside>load_from_query<aside>(/<a href="datum.html">datum</a>/<a href="datum/db_query.html">db_query</a>/query)  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L105"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 105"></a></aside></h3><p>Handles loading the players that have this rank from an already-executed
database query.</p>
<p>Mostly just a helper to simplify the logic of the subsystem.</p><h3 id="proc/load_legacy"><aside class="declaration">proc </aside>load_legacy<aside>()  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L123"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 123"></a></aside></h3><p>Handles loading the players that have this rank from its legacy config file.</p>
<p>Don't override this, use <code>clear_existing_rank_data()</code> to clear up anything
that needs to be cleared/initialized before loading the rank, and
<code>add_player()</code> for actually giving the rank to the ckey in-game.</p><h3 id="proc/remove_player"><aside class="declaration">proc </aside>remove_player<aside>(ckey)  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L70"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 70"></a></aside></h3><p>Handles removing this rank from a player by their ckey. This is only
intended to be used for handling the in-game portion of removing this rank,
and not to save this change anywhere. That should be handled by the caller.</p>
<p>DO NOT FORGET TO ADD A <code>IsAdminAdvancedProcCall()</code> CHECK SO THAT ADMINS
CAN'T JUST USE THAT TO SKIP PERMISSION CHECKS!!!</p><h3 id="proc/remove_player_legacy"><aside class="declaration">proc </aside>remove_player_legacy<aside>(ckey)  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L87"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 87"></a></aside></h3><p>Handles removing this rank from a player using the legacy system, updating
the legacy config file in the process.</p>
<p>Don't override this, everything should be handled from <code>remove_player()</code>
and <code>save_legacy()</code>, this is mostly just a helper for convenience.</p>
<p>Arguments:</p>
<ul>
<li>ckey - The ckey of the player you want to no longer possess this player
rank.</li>
</ul><h3 id="proc/save_legacy"><aside class="declaration">proc </aside>save_legacy<aside>()  <a href="https://github.com/Skyrat-SS13/Skyrat-tg/blob/e507f9120bb0c3beecfe169d14193d90e7229a58/modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm#L149"><img src="git.png" width="16" height="16" title="modular_skyrat/modules/player_ranks/code/player_rank_controller/_player_rank_controller.dm 149"></a></aside></h3><p>Handles saving the players that have this rank using its legacy config file.</p>
<p>Don't override this, use <code>get_ckeys_for_legacy_save()</code> if you need to filter
the list of ckeys that will get saved.</p></main><footer>tgstation.dme <a href="https://github.com/Skyrat-SS13/Skyrat-tg/tree/e507f9120bb0c3beecfe169d14193d90e7229a58">e507f91</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.9.0</a></footer></body></html>